"use strict";(self.webpackChunksudeeparyan_knowledgebase=self.webpackChunksudeeparyan_knowledgebase||[]).push([[2605],{7201:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>a,frontMatter:()=>i,metadata:()=>c,toc:()=>h});var d=r(74848),s=r(28453);const i={},t=void 0,c={id:"RAG360/Retrieval/Unstructured/Reranking/Logical Reranking/Reciprocal Reranking",title:"Reciprocal Reranking",description:"Ranked fusion",source:"@site/docs/RAG360/Retrieval/Unstructured/Reranking/Logical Reranking/Reciprocal Reranking.md",sourceDirName:"RAG360/Retrieval/Unstructured/Reranking/Logical Reranking",slug:"/RAG360/Retrieval/Unstructured/Reranking/Logical Reranking/Reciprocal Reranking",permalink:"/docs/RAG360/Retrieval/Unstructured/Reranking/Logical Reranking/Reciprocal Reranking",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"ragSidebar",previous:{title:"Relative Score Fusion",permalink:"/docs/RAG360/Retrieval/Unstructured/Reranking/Logical Reranking/Relative Score Fusion"},next:{title:"Contextual Compressors",permalink:"/docs/RAG360/Retrieval/Unstructured/Contextual Compressors"}},l={},h=[{value:"Ranked fusion",id:"ranked-fusion",level:3},{value:"Keyword and Vector Search Ranks, Scores, and Calculations",id:"keyword-and-vector-search-ranks-scores-and-calculations",level:3},{value:"Ranked fusion results without alpha",id:"ranked-fusion-results-without-alpha",level:3},{value:"Combined Ranked fusion",id:"combined-ranked-fusion",level:3},{value:"Detailed Calculations",id:"detailed-calculations",level:3},{value:"Ranked fusion final result",id:"ranked-fusion-final-result",level:3}];function o(e){const n={code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.h3,{id:"ranked-fusion",children:"Ranked fusion"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Currently ranked fusion is supported in ",(0,d.jsx)(n.code,{children:"Weaviate"})," and not in ",(0,d.jsx)(n.code,{children:"Qdrant"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Ranked Fusion is used to combine results from multiple search systems or\r\nmodels to produce a single, more effective ranking of nodes/documents."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Consider in the configuration of retriever, similarity_top = 5 and alpha =\r\n0.6, this will retrieve 5 nodes from dense vectors (vector search) and 5\r\nnodes from sparse vectors (keyword search) and then use this fusion algorithm\r\nto provide the top 5 nodes."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"In this algorithm, each object is scored according to its position in the\r\nresults for the given search, starting from the highest score for the\r\ntop-ranked object and decreasing down the order. The total score is\r\ncalculated by adding these rank-based scores from the vector and keyword\r\nsearches."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Consider, the retriever returns five objects with document id (from 0 to 4),\r\nand scores from keyword and vector search, ordered by score."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Search Type"}),(0,d.jsx)(n.th,{children:"(id): score"}),(0,d.jsx)(n.th,{children:"(id): score"}),(0,d.jsx)(n.th,{children:"(id): score"}),(0,d.jsx)(n.th,{children:"(id): score"}),(0,d.jsx)(n.th,{children:"(id): score"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Keyword"}),(0,d.jsx)(n.td,{children:"(1): 5"}),(0,d.jsx)(n.td,{children:"(0): 2.6"}),(0,d.jsx)(n.td,{children:"(2): 2.3"}),(0,d.jsx)(n.td,{children:"(4): 0.2"}),(0,d.jsx)(n.td,{children:"(3): 0.09"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Vector"}),(0,d.jsx)(n.td,{children:"(2): 0.6"}),(0,d.jsx)(n.td,{children:"(4): 0.598"}),(0,d.jsx)(n.td,{children:"(0): 0.596"}),(0,d.jsx)(n.td,{children:"(1): 0.594"}),(0,d.jsx)(n.td,{children:"(3): 0.009"})]})]})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:" Formula to calculate the ranked fusion - 1/(RANK + 60)\n"})}),"\n",(0,d.jsx)(n.h3,{id:"keyword-and-vector-search-ranks-scores-and-calculations",children:"Keyword and Vector Search Ranks, Scores, and Calculations"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Document ID"}),(0,d.jsx)(n.th,{children:"Keyword Rank"}),(0,d.jsx)(n.th,{children:"Keyword Calculation"}),(0,d.jsx)(n.th,{children:"Keyword Score"}),(0,d.jsx)(n.th,{children:"Vector Rank"}),(0,d.jsx)(n.th,{children:"Vector Calculation"}),(0,d.jsx)(n.th,{children:"Vector Score"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"1"}),(0,d.jsx)(n.td,{children:"0"}),(0,d.jsx)(n.td,{children:"1 / (0 + 60)"}),(0,d.jsx)(n.td,{children:"0.0167"}),(0,d.jsx)(n.td,{children:"3"}),(0,d.jsx)(n.td,{children:"1 / (3 + 60)"}),(0,d.jsx)(n.td,{children:"0.0159"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"0"}),(0,d.jsx)(n.td,{children:"1"}),(0,d.jsx)(n.td,{children:"1 / (1 + 60)"}),(0,d.jsx)(n.td,{children:"0.0164"}),(0,d.jsx)(n.td,{children:"2"}),(0,d.jsx)(n.td,{children:"1 / (2 + 60)"}),(0,d.jsx)(n.td,{children:"0.0161"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"2"}),(0,d.jsx)(n.td,{children:"2"}),(0,d.jsx)(n.td,{children:"1 / (2 + 60)"}),(0,d.jsx)(n.td,{children:"0.0161"}),(0,d.jsx)(n.td,{children:"0"}),(0,d.jsx)(n.td,{children:"1 / (0 + 60)"}),(0,d.jsx)(n.td,{children:"0.0167"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"4"}),(0,d.jsx)(n.td,{children:"3"}),(0,d.jsx)(n.td,{children:"1 / (3 + 60)"}),(0,d.jsx)(n.td,{children:"0.0159"}),(0,d.jsx)(n.td,{children:"1"}),(0,d.jsx)(n.td,{children:"1 / (1 + 60)"}),(0,d.jsx)(n.td,{children:"0.0164"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"3"}),(0,d.jsx)(n.td,{children:"4"}),(0,d.jsx)(n.td,{children:"1 / (4 + 60)"}),(0,d.jsx)(n.td,{children:"0.0156"}),(0,d.jsx)(n.td,{children:"4"}),(0,d.jsx)(n.td,{children:"1 / (4 + 60)"}),(0,d.jsx)(n.td,{children:"0.0156"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"ranked-fusion-results-without-alpha",children:"Ranked fusion results without alpha"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Search Type"}),(0,d.jsx)(n.th,{children:"(id): score"}),(0,d.jsx)(n.th,{children:"(id): score"}),(0,d.jsx)(n.th,{children:"(id): score"}),(0,d.jsx)(n.th,{children:"(id): score"}),(0,d.jsx)(n.th,{children:"(id): score"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Keyword"}),(0,d.jsx)(n.td,{children:"(1): 0.0167"}),(0,d.jsx)(n.td,{children:"(0): 0.0160"}),(0,d.jsx)(n.td,{children:"(2): 0.0161"}),(0,d.jsx)(n.td,{children:"(4): 0.0154"}),(0,d.jsx)(n.td,{children:"(3): 0.0156"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Vector"}),(0,d.jsx)(n.td,{children:"(2): 0.0167"}),(0,d.jsx)(n.td,{children:"(4): 0.0160"}),(0,d.jsx)(n.td,{children:"(0): 0.0161"}),(0,d.jsx)(n.td,{children:"(1): 0.0154"}),(0,d.jsx)(n.td,{children:"(3): 0.0156"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"combined-ranked-fusion",children:"Combined Ranked fusion"}),"\n",(0,d.jsx)(n.p,{children:"Results with alpha value(\u03b1)"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"When \u03b1 = 1, the final score is determined solely by the vector search (dense\r\nvectors)."}),"\n",(0,d.jsx)(n.li,{children:"When \u03b1 = 0, the final score is determined solely by the keyword search\r\n(sparse vectors)."}),"\n",(0,d.jsx)(n.li,{children:"With \u03b1 = 0.6, we will combine 60% of the keyword score and 40% of the vector\r\nscore."}),"\n",(0,d.jsx)(n.li,{children:"Combined\xa0Score=\u03b1\u22c5Keyword\xa0Score+(1\u2212\u03b1)\u22c5Vector\xa0Score"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"detailed-calculations",children:"Detailed Calculations"}),"\n",(0,d.jsx)(n.p,{children:"For Combined Ranked Fusion Results with \u03b1 = 0.6"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Document ID"}),(0,d.jsx)(n.th,{children:"Keyword Score"}),(0,d.jsx)(n.th,{children:"Vector Score"}),(0,d.jsx)(n.th,{children:"Combined Score Calculation"}),(0,d.jsx)(n.th,{children:"Combined Score"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"1"}),(0,d.jsx)(n.td,{children:"0.0167"}),(0,d.jsx)(n.td,{children:"0.0154"}),(0,d.jsx)(n.td,{children:"(0.6 _ 0.0167) + (0.4 _ 0.0154)"}),(0,d.jsx)(n.td,{children:"0.01638"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"0"}),(0,d.jsx)(n.td,{children:"0.0160"}),(0,d.jsx)(n.td,{children:"0.0161"}),(0,d.jsx)(n.td,{children:"(0.6 _ 0.0160) + (0.4 _ 0.0161)"}),(0,d.jsx)(n.td,{children:"0.01604"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"2"}),(0,d.jsx)(n.td,{children:"0.0161"}),(0,d.jsx)(n.td,{children:"0.0167"}),(0,d.jsx)(n.td,{children:"(0.6 _ 0.0161) + (0.4 _ 0.0167)"}),(0,d.jsx)(n.td,{children:"0.01634"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"4"}),(0,d.jsx)(n.td,{children:"0.0154"}),(0,d.jsx)(n.td,{children:"0.0160"}),(0,d.jsx)(n.td,{children:"(0.6 _ 0.0154) + (0.4 _ 0.0160)"}),(0,d.jsx)(n.td,{children:"0.01568"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"3"}),(0,d.jsx)(n.td,{children:"0.0156"}),(0,d.jsx)(n.td,{children:"0.0156"}),(0,d.jsx)(n.td,{children:"(0.6 _ 0.0156) + (0.4 _ 0.0156)"}),(0,d.jsx)(n.td,{children:"0.0156"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"ranked-fusion-final-result",children:"Ranked fusion final result"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Algorithm Type"}),(0,d.jsx)(n.th,{children:"(id): score"}),(0,d.jsx)(n.th,{children:"(id): score"}),(0,d.jsx)(n.th,{children:"(id): score"}),(0,d.jsx)(n.th,{children:"(id): score"}),(0,d.jsx)(n.th,{children:"(id): score"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Ranked"}),(0,d.jsx)(n.td,{children:"(1): 0.01638"}),(0,d.jsx)(n.td,{children:"(2): 0.01634"}),(0,d.jsx)(n.td,{children:"(0): 0.01604"}),(0,d.jsx)(n.td,{children:"(4): 0.01568"}),(0,d.jsx)(n.td,{children:"(3): 0.01568"})]})})]})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(o,{...e})}):o(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>c});var d=r(96540);const s={},i=d.createContext(s);function t(e){const n=d.useContext(i);return d.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),d.createElement(i.Provider,{value:n},e.children)}}}]);